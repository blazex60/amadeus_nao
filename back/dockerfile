FROM python:3.10-slim

# uvのバイナリを直接取得
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

WORKDIR /app

# 依存関係ファイルのコピー
COPY back/pyproject.toml .
# ロックファイルがある場合はそれもコピー
COPY back/uv.lock . 

# 依存関係のインストール (--frozen は lockファイルがある場合)
RUN uv sync --frozen --no-install-project

# アプリケーションコードのコピー
COPY back/ .

# uv経由で実行（venvを自動で認識します）
CMD ["uv", "run", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]